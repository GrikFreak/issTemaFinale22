<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>

<style type="text/css">
body
{
    margin-left:  30px;
    margin-right: 30px;
};

P
{
    font-family: Tahoma;
    font-size: 10pt;
};

a, a:visited, a:active, a:link, a:hover {
    text-decoration: underline;
    color: #545454;
    background-color: transparent;
	font-size: 93%;
}

a:hover {
    background-color: #cccccc;
}


hr {
    clear: both;
    height: 1px;
    color: #242424;
    background-color: transparent;
}

h1, h2, h3 {
    color: #242424;
    clear: left;
    font: 100% Tahoma, Helvetica, Arial, sans-serif;
    margin-bottom: 0.5em;
    padding-top: 0.5em;
	border-radius: 10px;
	padding: 5px;
}

top {
	width: 100%;
}


#i {
    color: #ff1010;
}
tt{
	font-family: "Arial";
    font-size: 90%;
	color: #006600;
}
em{
	font-family: "Arial";
    font-size: 80%;
	font-weight: bold;
	border-style:solid;
	border-color: #abe876;
    color: #1632cc;
}
bc{
	font-family: "Arial";
	font-size: 90%;
	font-weight: bold;
    color: #990000;
	background-color: #fcf8c7;
}
ks{
	font-family: "Arial";
	font-weight: bold;
    color: #0000CD	;
	font-size: 90%;
}
kc{
	font-family: "Arial";
	font-weight: bold;
    color: #008000	;
	font-size: 90%;
}
kr{
	font-family: "Arial";
	font-weight: bold;
    color: #ff0000	;
	font-size: 90%;
}
pre{
	font-family: "Consolas";
	font-size: 85%;
	background-color: #f5f5f5;
	border: 1.5px solid silver;
	padding: 5px;
}
m{
	font-family: "Helvetica";
	line-height: 100%;
 	font-size: 75%;
}
div.body{

    font-size: 18px;
}
k{
    color: #990000;
	font-weight: bold;
	font-size: 90%;
}
h1 {
    font-size: 150%;
    background-color: #b2c0ff;
	padding: 10px;
}

h2 {
    background-color: #9ed8ff;
    font-size: 130%;
}

h3 {
	background-color: #e6ccff;
    font-size: 100%;
}
h4 {
    background-color: #ccffcc;
    font-size: 100%;
	width: 95%;
	border-radius: 5px;
	padding: 2px;
}
h5 {
    background-color: #d5ffb0;
    font-size: 100%;

}
div.req{
	background-color: #d9ffb3;
    font-size: 18px;
	width: 700px;
    border: 3px solid green;
    padding: 15px;
    margin: 10px;
}
div.remark{
	background-color: #E3F2FD;
    border: 1.5px solid #d5f2ed;
    padding: 15px;
    margin: 10px;
	border-radius: 25px;
}
table, th, td {
  border: 1px solid black;
  border-collapse: collapse;
}

#exampleclass tbody,
#exampleclass thead,
#exampleclass th {
  border: 0;
}

ol, ul, li {
  margin: 0;
  margin-left: 10px;
  padding: 0;
  padding-bottom: 5px;
}

table, th, td {
	border: 1px solid black;
}

img {
	border: 1.5px solid #d5f2ed

}

a, a:visited, a:active, a:link, a:hover {
    text-decoration: underline;
    color: #545454;
    background-color: transparent;
}

div.wrapdesc{
	width: 90%;
	margin: auto;
}

div.imagedesc{
	width: 85%;
	margin: auto;
}
</style>

<head>

<title>SPRINT 2 : Led and Sonar</title></head>

<body>
<div id="top">
<h1>SPRINT_2 : Led and Sonar<font size="5"></font> </h1>
</div>

<div class="body">

  <h2>Recap Sprint 1</h2>
  <div>
      <center><img src="images/CoreRobotArchitecture.png" alt="corerobot_logical_architecture" width="100%"></center>
      <br>
      <a href="https://github.com/GrikFreak/issTemaFinale22/blob/main/it.unibo.CoreAnalysis-Sprint1/src/CoreWSBasicRobot.qak"> <ks>Core with Robot Executable model</ks></a>
      <br><br>
      <div> <b>Relevant tests:</b>
        <br><br>
        <a href="https://github.com/GrikFreak/issTemaFinale22/blob/main/it.unibo.CoreAnalysis-Sprint1/test/TestWasteRequest.java" >TestWasteRequest</a>
        <br>
        <a href="https://github.com/GrikFreak/issTemaFinale22/blob/main/it.unibo.CoreAnalysis-Sprint1/test/TestPickUp.java" >TestPickUp</a>
      </div>
  </div>
<h2>Requirements</h2>
<div id="Requirements" class="remark">
  For the complete requirements see <a href="../../it.unibo.CoreAnalysis-Sprint1/userDocs/CoreAnalysis-Sprint1.2.html#requirments">Requirements</a>
</div>

<h2>Requirement analysis</h2>
<div class="remark">
<div class="remark" id = "Requirements_analysis">
  <h3>Led and Sonar requirements</h3>
  <h4><a href="#R3">R3</a></h4>
  <div class="remark" id="R1A">
    <kc>Formalization</kc>:the status of the LED changes according to the position and the status of the trolley; more precisly : 
        <li>The Led is off when the transport trolley is at HOME.</li>
        <li>The Led blinks while the transport trolley is moving.</li>
        <li>The Led is on when transport trolley is stopped.</li>
  </div>
  <h4><a href="#R4">R4</a></h4>
  <div class="remark" id="R1B">
    <kc>Formalization</kc>: The Sonar is used as an ‘alarm device’: when it measures a distance less that a prefixed value DLIMT, the transport trolley must be stopped. It will be resumed when Sonar detects again a distance higher than DLIMT.
  </div>
  <div>
    <a href="https://github.com/GrikFreak/issTemaFinale22/blob/main/it.unibo.Sprint2/src/sprint2.qak" > <ks>R3-R4 Executable model</ks></a>
  </div>

  <h3>Non-functional requirements</h3>
  <h4>Sonar</h4>
  <div class="remark" id="proactive">
    <kc>Proactive</kc>: The Sonar is a proactive actor because is in charge of compute the distance from an obstacle. 
  </div>
  <div class="remark" id="reactive">
    <kc>Reactive</kc>:The Sonar is also a reactive actor, because i the begging is started from the TransportTrolley.
  </div>
  <h4>Led</h4>
  <div class="remark" id="reactive">
    <kc>Reactive</kc>: The Led is only a reactive actor because it receives its status from the Waste Service
  </div>
  
</div>
<h2>Problem analysis</h2>
<div class="remark">
  <div>
   In this second sprint we will discuss the problematic concerned to the introduction of two new components, given by the commitment: 
   the <a href="https://github.com/anatali/issLab2022/tree/main/unibo.sonarqak22">SONAR</a> and the <a href="https://github.com/anatali/issLab2022/tree/main/unibo.ledqak22">LED</a>.
   Furthermore, the main problem that we have to handle is the way that these compenents will communicate each others. 
</div>
<h3>Led</h3>
<div class="remark" id=Led">
  The <kr>Led</kr> needs to update its status when the TransportTrolley changes its status.
  <h4>Problem n°0:How the transport Trolley comunicate its status to the WasteService</h4> 

  As it's the WasteService to command the TransportTrolley, to solve this problem
   we can keep track of the status and position of the trolley within the wasteService 
  <h4>Led Problem n°1: How to communicate the update of the Led status.</h4>  

  The WasteService needs to comunicate to the Led to change its status we could do it by two type of comunincation.
 <li>through an <kr>event</kr>: it's the easiest way , but if a comunication prolem occur the Led won't receive the message.
  Furthermore, if we use an event other components could receive the message.</li> 
 <li>through a <kr>dispatch</kr>: the strenght of the comunication is greater but in this way the Waste Service needs to know the existace of the Led. </li> 

 
 
</div>
<table cellpadding="20%" style="border: 0px solid transparent;width:98%;" style="width:98%">
  <tr>
    <td style="border: 0px">
        <center><img src="images/wasteTruck.png" alt="waste_truck" width="60%"><center>
    </td>
    <td style="border: 0px">
      <center><table cellpadding="5%">
        <tbody><tr>
            <th>Message</th>
            <th>Semantic</th>
        </tr>
        <tr>
            <td rowspan="1">led_status</td>
            <td rowspan="1">event</td>
        </tr>
    </tbody></table></center>
  </td>
</tr>
</table>
<h3>Sonar </h3>
<div class="remark" id="Sonar">
  <h4>Problem n°1: Who is the best receiver of the distance emitted by the sonar?</h4>
The main role of sonar is to emit a continuous stream of data (measured distance) and send it to the Waste Service.
As it is a continous stream is not recommended to use dispatches or reply/request, but events;
with the help of events, the data emitted by the sonar can be received by several different entities:

<ks>TransportTrolley:</ks>
	<ul>
		<li><kr>Pros</kr> : if the data were received directly from the trolley, it could automatically process the distances and stop itself.</li>
		<li><kr>Cons</kr>:the structure of the Trolley would be more complicated, giving up the role of pure actuator.</li>
	
	</ul>
	<ks>WasteService:</ks>
	<ul>
		<li><kr>Pros</kr>:If the data were received by the WasteService, it would become even more the fulcrum of the system.</li>
		<li><kr>Cons</kr>:the structure of the WasteService would be more complicated, and it would be  needed  to communicate the stop/resume action to the TransportTrolley.</li>
	</ul>

  <h4>Problem n°2: How the TransportTrolley receives the command Stop/Resume ? And from who ? </h4>
  If the Sonar data is received directly from the TransportTrolley then it will automatically stop based on the data received from the Sonar.
  If instead the data is received by the WasteService, it will be he who will send the command to the Trolley, which will keep the task of pure actuator in the system.
  The WasteService could send the command <ks>stop/resume</ks> in three different ways:

<li>through an <kr>event</kr>: it's the easiest way , but if a comunication prolem occur the TransportTrolley won't receive the message , causing dangerous consequences.</li> 
<li>through a <kr>dispatch</kr>: the strenght of the comunication is greater and so we don't have to think of possibile communication problems. </li> 
<li>through a <kr>request/reply</kr>: the strenght of the comunication is great, but the WasteService will have to wait a reply from the TransportTrolley.</li> 

<h4>Problem n°3: How to keep track of the TransportTrolley status when it's stopped? </h4>

</div>
<table cellpadding="20%" style="border: 0px solid transparent;width:98%;" style="width:98%">
  <tr>
    <td style="border: 0px">
        <center><img src="images/CoreWS.png" alt="core_waste_service" width="70%"><center>
    </td>
    <td style="border: 0px">
      <center><table cellpadding="5%">
        <tbody><tr>
            <th>Message</th>
            <th>Semantic</th>
        </tr>
        <tr>
            <td rowspan="1">loadaccept</td>
            <td rowspan="1">reply</td>
        </tr>
        <tr>
            <td rowspan="1">loadrejected</td>
            <td rowspan="1">reply</td>
        </tr>
        <tr>
          <td rowspan="1">pickup_request</td>
          <td rowspan="1">request</td>
          </tr>
          <tr>
          <td rowspan="1">pickup_done</td>
          <td rowspan="1">reply</td>
        </tr>

    </tbody></table></center>
  </td>
</tr>
</table>



<div id="logical_architecture">
  <h3>Logical Architecture</h3>
  From the previous considerations on the components of the system it is possible to define a first logical architecture: <br><br>
  <center><img src="images/CoreLogicalArchitecture.png" alt="core_logical_architecture" width="100%"></center>
</div>

<div id="robot_components">
<h3>Robot Components</h3>
In addition to the basic robot, the customer provides components for the construction of the transport trolley. This facilitates the management of the trolley movement.
<div>
<br>
The trolley must follow a <b>path</b> to do a deposit action. Now  is necessary to consider if the trolly is implemented by a  static path or a dinamic one.
If the Trolley use a Static Path means that all the possible paths are known by the Waste Service.<br>
Instead, if the Trolley uses a Dinamic Path the Application need to compute the path, in this case we could use a planner.
</div>
<div>1) <a href="https://github.com/anatali/issLab2022/tree/main/unibo.planner22"><ks>Planner</ks></a>: which finds the best route for the TransportTrolley to take. </div>
<div>2) <a href="https://github.com/anatali/issLab2022/tree/main/unibo.pathexecutor"><ks>Pathexecutor</ks></a>: which performs the actions determined by the planner one at a time. </div>
<div>
  <br>
  The path, which is made up of a series of movements that the trolley must perform, can be understood in two ways, dipendently on how the Trolley can move in the map:
  The map in which the Trolley is moving could be divided in cell with side RD. Then the Trolley could move in it by 
  accessing only adjacent cells (therefore only those with one side in common) or also accessing those placed diagonally.
  If the trolley could move only to the adjacent cells the implementation would be easier but the size of the Path would be greater.
  Instead if it could go also diagonally it would be faster but a new pathfinding logic would need to be implemented for this case.
</div>
<!-- 
<h3>Configuration file</h3>
To make easier and more flexible the implementation we thought to use a configuration file, in which there are all the set information, like MAXPB and MAXGB.
There is also the possibility to save and then access to the coordinates (X, Y) of each relevant position in the map.
<br>It could have been written in JSON.<br>
<a href="../resources/ConfigurationFile.json">Configuration file json</a><br>
<br> -->
<h3>Problems</h3>
With the addition of the Planner and the Path Executor the problems we incurred were about the communication between these new components and the transport trolley.
<br>The planner has been integrated in the WasteService, before the request to the transport trolley, we ask to plan the path that it has to do.
<br>After that, the WasteService has to communicate with the trolley to let him know the path.
<br><br>A <b>dispatch</b> cannot be the best solution because the WS need to know when the trolley has ended its action, to give it a new path to execute.
<br>An <b>event</b> incurr in the same dispatch problem and then could incourring some comunication problems.
<br>A <b>request-reply</b> is a better solution. In this way the WS send the request and wait to the Transport Trolley to reply; then we execute this actions for each trolley movement (home -> indoor -> container -> home/indoor).
<br><br><a href="https://github.com/GrikFreak/issTemaFinale22/blob/main/it.unibo.CoreAnalysis-Sprint1/src/CoreWSBasicRobot.qak"> <ks>Core with Robot Executable model</ks></a>
<h3>Architecture updated</h3>
<center><img src="images/CoreRobotArchitecture.png" alt="corerobot_logical_architecture" width="100%"></center>
Due to the addition of the new components we decided to change the message that the trolley sends to the WS when it finishes the deposit action. 
<br>The dispatch <ks>withdrawal_done</ks> becomes the reply (<ks>storage_done</ks>) of the new request <ks>storage_request</ks>, because these had the same role in the architecture.
To also communicate the Path to Home for the same reasons said before we added a reply and a request respectively <ks>home_rquest</ks> and <ks>home_done</ks>
We have also added a PathExectur to perform the trolley steps planned by the planner.
</div>


</div>

<h2>Test plans</h2>
<div id="test_plans">
  <div class="remark">
    Test plans are coded in Java (JUnit). 
    Since both tests develop more functionality of the System, both are integration tests.

    <h3>TestPlan: waste_request</h3>
    <a href="https://github.com/GrikFreak/issTemaFinale22/blob/main/it.unibo.CoreAnalysis-Sprint1/test/TestWasteRequest.java" >TestWasteRequest</a>
    
    <div><ks>Test loadRejecetd</ks>:</div>
    <div>The waste_truck sends a waste request to the WasteService for a waste quantity that is greater then the container capacity and this replies with a loadrejected. </li> 
    
    <div><ks>Test loadAccepted</ks>:</div> 
    <div>The waste truck sends a waste request to the WasteServicefor a waste quantity that is lower then the container capacity and this replies with a loadaccept.</div> 
    
    <h3>TestPlan: pickup_request</h3> 
    <a href="https://github.com/GrikFreak/issTemaFinale22/blob/main/it.unibo.CoreAnalysis-Sprint1/test/TestPickUp.java" >TestPickUp</a>
    
    <div><ks>Test testPickUpDone</ks>:</div>
    <div>When the waste load is accepted, the WasteService sends to the transport_trolley a request and the TransportTrolley reply with a pickup_done when it has finished the pickup action.</div> 
   </div>

   <h3>TestPlan: storage_request</h3> 
   <a href="https://github.com/GrikFreak/issTemaFinale22/blob/main/it.unibo.CoreAnalysis-Sprint1/test/TestPickUp.java" >TestStorage</a>
   
   <div><ks>Test testStorageDone</ks>:</div>
   <div>After the Waste Service recieved the pickup_done reply it sends to the TransportTrolley the <ks>storage_request</ks> and then the  TransportTrolley sends the reply <ks>storage_done</ks>.</div> 
   <h3>TestPlan: home_request</h3> 
   <a href="https://github.com/GrikFreak/issTemaFinale22/blob/main/it.unibo.CoreAnalysis-Sprint1/test/TestHome.java" >TestHome</a>
  
   <div><ks>Test testHomeDone</ks>:</div>
   <div>After the Waste Service recieved the storage_done reply , if it has no request from a WasteTruck in its queue, it sends to the TransportTrolley the <ks>home_request</ks> to send it to Home and then the  TransportTrolley sends the reply <ks>home_done</ks> when it is at home.</div> 

  </div>

 </div>
</div>

<h2>Recap analysis</h2>
<div>
  <center><img src="images/CoreRobotArchitecture.png" alt="corerobot_logical_architecture" width="100%"></center>
  <br>
  <a href="https://github.com/GrikFreak/issTemaFinale22/blob/main/it.unibo.CoreAnalysis-Sprint1/src/CoreWSBasicRobot.qak"> <ks>Core with Robot Executable model</ks></a>
  <br><br>
  <div> <b>Relevant tests:</b>
    <br><br>
    <a href="https://github.com/GrikFreak/issTemaFinale22/blob/main/it.unibo.CoreAnalysis-Sprint1/test/TestWasteRequest.java" >TestWasteRequest</a>
    <br>
    <a href="https://github.com/GrikFreak/issTemaFinale22/blob/main/it.unibo.CoreAnalysis-Sprint1/test/TestPickUp.java" >TestPickUp</a>
  </div>
</div>


</div>

<h2>Testing</h2>

<h2>Work Plan</h2>
<div id="work_plan">
  <div class="remark">
   At the end of Sprint 1 to complete the work are necessary two other sprints:
    <ul>
     <li>Sprint 2: to introduct the LED and the SONAR</li>
     <li>Sprint 3: to introduct the GUI</li>
    </ul>
    This order can let us complete some features that we cannot implent in the Sprint 3.
  </div>
</div>

<br/><br/>
</div>

<div style="background-color:rgba(86, 56, 253, 0.9); width:60%;text-align:left;color:white">
<li>By Bignami Filippo, Greco Davide</li>
<li>email: filippo.bignami@studio.unibo.it,  davide.greco4@studio.unibo.it</li>
<li>GitHub repository: https://github.com/GrikFreak/issTemaFinale22</li>
</div>
</body>
</html>